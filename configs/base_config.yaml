# Base Configuration for Dealer Scrapers
# This file contains default patterns that work across most dealer locator websites

selectors:
  # Common patterns for search input fields
  search_input:
    - "input[placeholder*='Zip']"
    - "input[placeholder*='zip']"
    - "input[placeholder*='City']"
    - "input[placeholder*='city']"
    - "input[placeholder*='Location']"
    - "input[placeholder*='location']"
    - "input[aria-label*='Zip']"
    - "input[aria-label*='zip']"
    - "input[aria-label*='City']"
    - "input[aria-label*='city']"
    - "input[type='search']"
    - "input[name*='zip']"
    - "input[name*='city']"
    - "input[id*='zip']"
    - "input[id*='city']"
    - "input[class*='zip']"
    - "input[class*='search']"

  # Patterns for search/submit buttons
  search_button:
    - "button[type='submit']"
    - "button:has-text('Search')"
    - "button:has-text('Find')"
    - "button:has-text('Go')"
    - "input[type='submit']"
    - "[aria-label*='Search']"

  # Common patterns for dealer card/list items
  dealer_cards:
    - "li[class*='dealer']"
    - "li[class*='Dealer']"
    - "div[class*='dealer-card']"
    - "div[class*='dealerCard']"
    - "div[class*='dealer_item']"
    - "div[class*='dealer-item']"
    - "div[class*='result-item']"
    - "div[class*='resultItem']"
    - "article[class*='dealer']"
    - "article[class*='result']"
    - "div[data-dealer-id]"
    - "div[data-dealer]"
    - "[class*='dealer-listing']"
    - "[class*='dealerListing']"

  # Patterns for "Apply" or "Search" buttons on filter pages
  apply_button:
    - "button:has-text('Apply')"
    - "button:has-text('Filter')"
    - "button:has-text('Show Results')"
    - "button[type='submit']"
    - "input[type='submit'][value*='Apply']"

  # Patterns for "View More" / "Load More" buttons
  view_more_button:
    - "button:has-text('View More')"
    - "button:has-text('Load More')"
    - "button:has-text('Show More')"
    - "button:has-text('See More')"
    - "a:has-text('View More')"
    - "a:has-text('Load More')"
    - "[class*='view-more']"
    - "[class*='load-more']"

  # Patterns for scroll containers
  scroll_container:
    - "div[class*='results']"
    - "div[class*='list']"
    - "div[class*='container']"
    - "[class*='scroll']"
    - "[class*='dealer-list']"

# Data field selectors within dealer cards
data_fields:
  name:
    selector: null
    type: text
    fallback_patterns:
      - "h2"
      - "h3"
      - "h4"
      - "[class*='name']"
      - "[class*='title']"
  address:
    selector: null
    type: text
    fallback_patterns:
      - "[class*='address']"
      - "[class*='location']"
      - "[class*='addr']"
  phone:
    selector: null
    type: href
    attribute: href
    fallback_patterns:
      - "a[href^='tel:']"
      - "[class*='phone']"
      - "[class*='tel']"
  website:
    selector: null
    type: href
    attribute: href
    fallback_patterns:
      - "a[href^='http']"
      - "[class*='website']"
      - "[class*='site']"

interactions:
  # Search behavior
  search_sequence:
    - fill_input
    - press_enter
  pagination_type: view_more  # Options: view_more, scroll, pagination, none
  
  # Default wait times (in seconds)
  wait_after_page_load: 3
  wait_after_search: 4
  wait_after_apply: 3
  scroll_delay: 0.5
  view_more_delay: 2
  click_delay: 0.3
  max_scroll_iterations: 30
  max_no_new_count: 3

# Input fields configuration
input_fields:
  zip_code:
    selector: null  # Use search_input selectors
    type: text
    required: true
  radius:
    selector: null
    type: select
    required: false
    default_value: "50"

extraction:
  # Phone number patterns (regex)
  phone_patterns:
    - "\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}"
    - "\\d{3}[-.\\s]?\\d{3}[-.\\s]?\\d{4}"
    - "\\+?1[-.\\s]?\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}"

  # Name extraction patterns
  name_patterns:
    - "^\\d+\\.\\s*(.+)"  # "1. Dealer Name"
    - "^(.+?)\\s*\\|"  # "Name | Address"
    - "^(.+?)\\s*$"  # Just the name

  # Address patterns
  address_patterns:
    - ".+?,\\s*[A-Za-z\\s]+,\\s*[A-Z]{2}\\s+\\d{5}"
    - ".+?\\s+[A-Z]{2}\\s+\\d{5}"

  # Distance patterns
  distance_patterns:
    - "([\\d.]+)\\s*mi\\b"
    - "([\\d.]+)\\s*miles?\\b"

  # Website extraction - domains to skip
  skip_domains:
    - "maps.google.com"
    - "google.com"
    - "tel:"
    - "mailto:"

# Crawl4AI-specific interactions (JavaScript templates for browser automation)
crawl4ai_interactions:
  # Search action: Fill the search input with zip code
  search_action:
    type: js_code
    code_template: |
      const input = document.querySelector('{SEARCH_SELECTOR}');
      if (input) {
        input.value = '{ZIP_CODE}';
        input.dispatchEvent(new Event('input', { bubbles: true }));
        input.dispatchEvent(new Event('change', { bubbles: true }));
      }
    wait_after: 2
    wait_for: "css:.dealer-card"

  # Search submit: Click search button or press Enter
  search_submit:
    type: js_code
    code_template: |
      const btn = document.querySelector('{BUTTON_SELECTOR}');
      if (btn) {
        btn.click();
      } else {
        const input = document.querySelector('{SEARCH_SELECTOR}');
        if (input) {
          input.dispatchEvent(new KeyboardEvent('keydown', { key: 'Enter', code: 'Enter', keyCode: 13, bubbles: true }));
        }
      }
    alternative: press_enter

  # Load more action: Click "Load More" / "View More" button
  load_more_action:
    type: js_code
    code_template: |
      const btn = document.querySelector('{LOAD_MORE_SELECTOR}');
      if (btn && btn.offsetParent !== null) {
        btn.click();
        return true;
      }
      return false;
    max_iterations: 30

  # Virtual scroll configuration (for infinite scroll pages)
  virtual_scroll:
    enabled: false  # Set to true for Twitter-style infinite scroll
    container_selector: null  # CSS selector for scroll container (null = use body)
    scroll_count: 30  # Number of scroll actions to perform
    scroll_by: container_height  # Options: container_height, pixels, page_height
    wait_after_scroll: 0.5  # Seconds to wait after each scroll

# Post-search validation settings
post_search_validation:
  enabled: true  # Always enabled for accuracy
  expected_elements:
    - dealer_cards
  min_dealer_count: 1
  confidence_threshold: 0.7
  use_llm_refinement: true  # Use LLM to refine selectors if heuristics fail

# Discovery settings (Crawl4AI-based URL discovery)
discovery:
  use_crawl4ai: true  # Use Crawl4AI for link discovery
  cache_ttl_days: 30  # Cache TTL for discovery results
  max_depth: 2  # Maximum crawl depth (1 = homepage only, 2 = homepage + 1 level)
  max_urls_to_analyze: 100  # Maximum URLs to fetch from homepage
  filter_keywords:  # Keywords to filter dealer locator URLs
    - dealer
    - locator
    - find
    - locate
    - directory
    - location
    - store
