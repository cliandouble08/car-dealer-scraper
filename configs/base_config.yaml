# Base Configuration for Dealer Scrapers
# This file contains default patterns that work across most dealer locator websites

# Cookie Consent Banner Handling
cookie_consent:
  enabled: true
  selectors:
    # OneTrust
    - '#onetrust-accept-btn-handler'
    - '#onetrust-banner-sdk button[id*="accept"]'
    - '.onetrust-close-btn-handler'
    
    # CookieBot
    - '#CybotCookiebotDialogBodyLevelButtonLevelOptinAllowAll'
    - '#CybotCookiebotDialogBodyButtonAccept'
    - '#CybotCookiebotDialogBodyLevelButtonAccept'
    
    # TrustArc
    - '#truste-consent-button'
    - '.trustarc-agree-btn'
    
    # Cookie Law Info (WordPress plugin)
    - '#cookielawinfo-checkbox-accept'
    - '#cookie_action_close_header'
    
    # HubSpot
    - '#hs-eu-confirmation-button'
    
    # Osano Cookie Consent
    - '.cc-accept-all'
    - '.cc-btn.cc-allow'
    
    # Quantcast
    - '.qc-cmp2-summary-buttons button[mode="primary"]'
    
    # Didomi
    - '#didomi-notice-agree-button'
    
    # Termly
    - '[data-tid="banner-accept"]'
    
    # Generic data-testid patterns
    - '[data-testid="cookie-accept"]'
    - '[data-testid="accept-cookies"]'
    - '[data-testid="cookie-banner-accept"]'
    
    # Generic text-based patterns (Playwright :has-text)
    - 'button:has-text("Accept All")'
    - 'button:has-text("Accept all")'
    - 'button:has-text("Accept All Cookies")'
    - 'button:has-text("Accept Cookies")'
    - 'button:has-text("Allow All")'
    - 'button:has-text("Allow all")'
    - 'button:has-text("I Accept")'
    - 'button:has-text("I Agree")'
    - 'button:has-text("Agree")'
    - 'button:has-text("Got it")'
    - 'button:has-text("OK")'
    
    # Generic class/ID patterns
    - '[class*="cookie-consent"] button[class*="accept"]'
    - '[class*="cookie-banner"] button[class*="accept"]'
    - '[class*="cookie-notice"] button[class*="accept"]'
    - '[class*="gdpr"] button[class*="accept"]'
    - '[id*="cookie-accept"]'
    - '[id*="accept-cookie"]'
    
    # Fallback generic patterns
    - '[class*="cookie"] button'
    - '[id*="cookie"] button'
    
  interactions:
    wait_for_banner: 2       # seconds to wait for banner to appear
    wait_after_click: 0.5    # seconds to wait after clicking accept
    max_retries: 2           # number of retry attempts
    check_iframes: true      # search for consent banners in iframes

selectors:
  # Common patterns for search input fields
  search_input:
    - "input[placeholder*='Zip']"
    - "input[placeholder*='zip']"
    - "input[placeholder*='City']"
    - "input[placeholder*='city']"
    - "input[placeholder*='Location']"
    - "input[placeholder*='location']"
    - "input[aria-label*='Zip']"
    - "input[aria-label*='zip']"
    - "input[aria-label*='City']"
    - "input[aria-label*='city']"
    - "input[type='search']"
    - "input[name*='zip']"
    - "input[name*='city']"
    - "input[id*='zip']"
    - "input[id*='city']"
    - "input[class*='zip']"
    - "input[class*='search']"

  # Patterns for search/submit buttons
  search_button:
    - "button[type='submit']"
    - "button:has-text('Search')"
    - "button:has-text('Find')"
    - "button:has-text('Update')"
    - "button:has-text('Go')"
    - "button:has-text('Submit')"
    - "input[type='submit']"
    - "[aria-label*='Search']"

  # Common patterns for dealer card/list items
  dealer_cards:
    - "li[class*='dealer']"
    - "li[class*='Dealer']"
    - "div[class*='dealer-card']"
    - "div[class*='dealerCard']"
    - "div[class*='dealer_item']"
    - "div[class*='dealer-item']"
    - "div[class*='result-item']"
    - "div[class*='resultItem']"
    - "article[class*='dealer']"
    - "article[class*='result']"
    - "div[data-dealer-id]"
    - "div[data-dealer]"
    - "[class*='dealer-listing']"
    - "[class*='dealerListing']"

  # Patterns for "Apply" or "Search" buttons on filter pages
  apply_button:
    - "button:has-text('Apply')"
    - "button:has-text('Filter')"
    - "button:has-text('Show Results')"
    - "button[type='submit']"
    - "input[type='submit'][value*='Apply']"

  # Patterns for "View More" / "Load More" buttons
  view_more_button:
    - "button:has-text('View More')"
    - "button:has-text('Load More')"
    - "button:has-text('Show More')"
    - "button:has-text('See More')"
    - "a:has-text('View More')"
    - "a:has-text('Load More')"
    - "[class*='view-more']"
    - "[class*='load-more']"

  # Patterns for scroll containers
  scroll_container:
    - "div[class*='results']"
    - "div[class*='list']"
    - "div[class*='container']"
    - "[class*='scroll']"
    - "[class*='dealer-list']"

  # Popup/Modal overlay patterns (blocking elements)
  popup_overlay:
    - ".modal-overlay"
    - "[class*='modal-overlay']"
    - "[class*='modalOverlay']"
    - ".modal-backdrop"
    - "[class*='backdrop'][class*='modal']"
    - ".overlay[class*='modal']"
    - "[class*='interstitial-overlay']"

  # Popup/Modal content containers (where inputs are)
  popup_container:
    - "[role='dialog']"
    - "[aria-modal='true']"
    - ".modal-content"
    - ".modal-dialog"
    - ".modal-body"
    - "[class*='modal-content']"
    - "[class*='modal-dialog']"
    - "[class*='modalContent']"
    - "[class*='popup-content']"
    - "[class*='lightbox-content']"

  # Zip input patterns within popups
  popup_zip_input:
    - "[role='dialog'] input[placeholder*='ZIP' i]"
    - "[aria-modal='true'] input[placeholder*='zip' i]"
    - ".modal-content input[placeholder*='zip' i]"
    - ".modal-dialog input[placeholder*='zip' i]"
    - "[class*='modal'] input[placeholder*='zip' i]"
    - "[class*='popup'] input[placeholder*='zip' i]"

  # Submit buttons within popups
  popup_submit:
    - "[role='dialog'] button[type='submit']"
    - "[aria-modal='true'] button[type='submit']"
    - ".modal-content button[type='submit']"
    - "[class*='modal'] button:has-text('Find')"
    - "[class*='modal'] button:has-text('Search')"
    - "[class*='modal'] button:has-text('Go')"

# Data field selectors within dealer cards
data_fields:
  name:
    selector: null
    type: text
    fallback_patterns:
      - "h2"
      - "h3"
      - "h4"
      - "[class*='name']"
      - "[class*='title']"
  address:
    selector: null
    type: text
    fallback_patterns:
      - "[class*='address']"
      - "[class*='location']"
      - "[class*='addr']"
  phone:
    selector: null
    type: href
    attribute: href
    fallback_patterns:
      - "a[href^='tel:']"
      - "[class*='phone']"
      - "[class*='tel']"
  website:
    selector: null
    type: href
    attribute: href
    fallback_patterns:
      - "a[href^='http']"
      - "[class*='website']"
      - "[class*='site']"

interactions:
  # Search behavior
  search_sequence:
    - fill_input
    - press_enter
  pagination_type: view_more  # Options: view_more, scroll, pagination, none
  
  # Default wait times (in seconds)
  wait_after_page_load: 3
  wait_after_search: 8
  wait_after_apply: 3
  scroll_delay: 0.5
  view_more_delay: 2
  click_delay: 0.3
  max_scroll_iterations: 30
  max_no_new_count: 3
  
  # Popup/Modal handling settings
  popup_wait_timeout: 3      # seconds to wait for popup after page load
  popup_dismiss_timeout: 5   # seconds to wait for popup to dismiss after submission
  max_popup_attempts: 3      # maximum popup handling retries

# Input fields configuration
input_fields:
  zip_code:
    selector: null  # Use search_input selectors
    type: text
    required: true
  radius:
    selector: null
    type: select
    required: false
    default_value: "50"

extraction:
  # Phone number patterns (regex)
  phone_patterns:
    - "\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}"
    - "\\d{3}[-.\\s]?\\d{3}[-.\\s]?\\d{4}"
    - "\\+?1[-.\\s]?\\(?\\d{3}\\)?[-.\\s]?\\d{3}[-.\\s]?\\d{4}"

  # Name extraction patterns
  name_patterns:
    - "^\\d+\\.\\s*(.+)"  # "1. Dealer Name"
    - "^(.+?)\\s*\\|"  # "Name | Address"
    - "^(.+?)\\s*$"  # Just the name

  # Address patterns
  address_patterns:
    - ".+?,\\s*[A-Za-z\\s]+,\\s*[A-Z]{2}\\s+\\d{5}"
    - ".+?\\s+[A-Z]{2}\\s+\\d{5}"

  # Distance patterns
  distance_patterns:
    - "([\\d.]+)\\s*mi\\b"
    - "([\\d.]+)\\s*miles?\\b"

  # Website extraction - domains to skip
  skip_domains:
    - "maps.google.com"
    - "google.com"
    - "tel:"
    - "mailto:"
